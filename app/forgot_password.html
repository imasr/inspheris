<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Mot de passe oublié</title>
        <link href="styles/theme.css" rel="stylesheet">
        <link href="styles/vendor.css" rel="stylesheet">  
        <script src="scripts/scripts.js"></script>
        <script src="scripts/vendor.js"></script>
        
		<!-- <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" />
		<script src="bower_components/jquery/dist/jquery.js"></script>
		<script src="bower_components/angular/angular.min.js"></script>
		<script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>  
        <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.css" /> -->
        
        <link rel="icon" href="favicon.ico" type="image/x-icon">
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
        <link type="image/x-icon" href="favicon.ico" />

        <style type="text/css">

            html { 
            }

            body { 
                background: url(../images/lively/bg.jpg) no-repeat center center fixed;  
                -webkit-background-size: cover;
                -moz-background-size: cover;
                -o-background-size: cover;
                background-size: cover;
                min-height:100%;
            }

            p
            {
                margin:10px 0;
                color: black;
            }

            html, body, .container-table {
                height: 100%;
                min-height:100%;
            }
            .container-table {
                display: table;
            }
            .vertical-center-row {
                display: table-cell;
                vertical-align: middle;
            }

            /*****loginPAGE****/

            .frgtPass-container.frgtPass {
                padding: 30px 30px;
                color: #fff;
                border-radius: 6px;
            }

            .frgtPass-container.frgtPass .btn {
                font-weight: 700;
                height: 44px;
                -moz-user-select: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
                cursor: pointer;
            }

            .frgtPass {
                background: rgba(255,255,255,0.85);
                padding: 20px 25px 30px;
                margin: 20px auto;
                border-radius: 2px;
                box-shadow: 5px 0 24px rgba(86,140,163,.15);
                -webkit-box-shadow: 5px 0 24px rgba(86,140,163,.15);
            }


            .form-frgt #inputEmail,
            .form-frgt #inputPassword {
                direction: ltr;
                height: 40px;
            }

            .form-frgt input[type=email],
            .form-frgt input[type=password],
            .form-frgt input[type=text],
            .form-frgt button {
                width: 100%;
                display: block;
                margin-bottom: 10px;
                z-index: 1;
                position: relative;
                box-sizing: border-box;
                height: 44px;
                border: 1px solid #ddd;
                box-shadow: 5px 0 24px rgba(86,140,163,.15);
                -webkit-box-shadow: 5px 0 24px rgba(86,140,163,.15);
            }

            .form-frgt .form-control:focus {
                border-color: rgb(125, 31, 91);
                outline: 0;
                padding-bottom: 10px;
                box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgb(104, 145, 162);
            }
            .form-frgt{
                padding-bottom: 10px;
            }

            .btn.btn-signin {
                /*background-color: rgb(125, 31, 91);*/
                padding: 0px;
                font-weight: 700;
                font-size: 14px;
                height: 36px;
                border-radius: 3px;
                border: none;
                transition: all 0.218s;
            }

            .btn.btn-signin:hover,
            .btn.btn-signin:active,
            .btn.btn-signin:focus {
                background-color: rgb(125, 175, 92);
            }
            @media (min-width: 992px){
                #forgot .col-md-6 {
                    width: 44%;
                }

                #forgot .col-md-offset-3 {
                    margin-left: 28%;
                }
            }

            .iconRotate {
                color: #37CAE8 !important;
                -webkit-animation:spin 2s linear infinite;
                -moz-animation:spin 2s linear infinite;
                animation:spin 2s linear infinite;
            }
            @-moz-keyframes spin {
                from { -moz-transform: rotate(0deg); }
                to { -moz-transform: rotate(360deg); }
            }
            @-webkit-keyframes spin {
                from { -webkit-transform: rotate(0deg); }
                to { -webkit-transform: rotate(360deg); }
            }
            @keyframes spin {
                from {transform:rotate(0deg);}
                to {transform:rotate(360deg);}
            }
            
            .refresh-Icon{
               cursor:pointer;
               margin-left: 20px;
               color: #757272;
               font-size: 20px; 
               margin-bottom: 10px;
            }
        </style>
        
    </head>
    <body ng-app="inspherisProjectApp">
        <div class="container container-table"  id="forgot">
            <div class="row vertical-center-row">
                <div class="col-md-6 col-md-offset-3 col-sm-6 col-sm-offset-3 col-xs-12">
                    <div class="frgtPass frgtPass-container">
                        <div class="text-center"> <img src="images/lively/logo.png">
                            <h2 style="color: #555;">Mot de passe oublié? </h2>
                            <p> Entrer votre identifiant et adresse mail ci-dessous pour réinitialiser votre mot de passe.</p>
                            <p> Nous vous enverrons un lien. Veuillez ouvrir le lien pour continuer.</p>
                            <!--<p> You may need to check your spam folder.</p>-->
                            <!--<p style="color:black;">Connexion avec identifiant et mot de passe</p>--> 
                        </div> 
                        <form class="form-frgt" name="forgotPasswordForm" ng-submit="submit()" ng-controller="ForgotPasswordCtrl">
                            <span id="reauth-email" class="reauth-email"></span>
                            <input type="text" class="form-control" ng-model="login" name="login" placeholder="S’identifier">
                            <input type="email" class="form-control" ng-model="email" name="email" placeholder="Email">
                            <div>					
                                <div>						
                                    <img id="captchaImg" src="{{captchaImg}}" style="padding-bottom: 10px;min-width: 50%"/>
                                    <span class="glyphicon glyphicon-refresh refresh-Icon" ng-class="{'iconRotate': refreshStart || !captchaImg}"  ng-click="reloadCaptcha();refreshStart = true;"></span>						
                                </div>
                                <div style="padding-bottom: 10px;">
                                    <input class="form-control" id="captcha" type="text" ng-model="captcha" name="captcha" placeholder="Captcha"/>
                                </div>
                            </div> 
                            <button class="btn btn-lg btn-danger btn-block btn-signin" type="submit" value="Send Email">Envoyer un email
                                <span ng-if="loadingStart"><i class="fa fa-spin fa-spinner"></i></span>
                            </button>
                        </form>
                        <div class="text-center">
                            <p style="color:red;display:none;" id="note"></p>
                            <a style="color:#2C93E4;" href="/login.html">Retour pour se connecter</a>
                            <p style="color:red;display:none;" id="note">Votre tentative de connexion <strong>a échoué</strong>, veuillez <strong>réessayer</strong>.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            angular.module('inspherisProjectApp', [])
                .controller('ForgotPasswordCtrl', ['$scope', '$http', '$window', function ($scope, $http, $window) {
                        //Get captcha
                        $scope.loadingStart = false;
                        $scope.refreshStart = false;
                        $scope.captchaImg = '';
                        $scope.captchaAnswer = '';
                        $scope.getCaptchaImage = function () {
                            $http.get('/api/captcha').then(function onSuccess(response) {
                                $scope.refreshStart = false;
                                var data = response.data;
                                if (typeof (data.code) != 'undefined' && data.code != null) {
                                    $("#note").html("Impossible de créer une image captcha. Veuillez contacter l’administrateur s’il vous plaît");
                                    $("#note").css("display", "block");
                                } else {
                                    $scope.captchaImg = "data:image/png;base64, " + data.image;
                                    $scope.captchaAnswer = data.answer;
                                }
                            });
                        };
                        $scope.getCaptchaImage();

                        $scope.reloadCaptcha = function () {
                            $scope.getCaptchaImage();
                        };

                        $scope.submit = function () {
                            $scope.loadingStart = true;
                            if (typeof ($scope.login) == 'undefined' || $scope.login == '') {
                                $("#note").html("Veuillez renseigner le login dans l’espace dédié, s’il vous plaît");
                                $("#note").css("display", "block");
                                $scope.loadingStart = false;
                                return null;
                            }

                            if (typeof ($scope.email) == 'undefined' || $scope.email == '') {
                                $("#note").html("Veuillez renseigner l’email dans l’espace dédié, s’il vous plaît");
                                $("#note").css("display", "block");
                                $scope.loadingStart = false;
                                return null;
                            }
                            if (typeof ($scope.captcha) == 'undefined' || $scope.captcha == '') {
                                $("#note").html("Veuillez saisir le captcha comme sur l’image, s’il vous plaît");
                                $("#note").css("display", "block");
                                $scope.loadingStart = false;
                                return null;
                            } else {
                                if ($scope.captcha != $scope.captchaAnswer) {
                                    $("#note").html("Veuillez saisir le captcha correctement comme  image");
                                    $("#note").css("display", "block");
                                    $scope.loadingStart = false;
                                    return null;
                                }
                            }

                            $http.get('/api/user/email/is-exist', {params: {login: $scope.login, email: $scope.email}}).then(function onSuccess(response) {
                                var data = response.data;
                                if (typeof (data.code) != 'undefined' && data.code != null) {
                                    $("#note").html(data.message);
                                    $("#note").css("display", "block");
                                    $scope.loadingStart = false;
                                } else {

                                    if (data) {
                                        var postdata = {
                                            login: $scope.login,
                                            email: $scope.email
                                        };

                                        $http.post('/api/user/password/send-mail-activate', postdata).then(function onSuccess(response) {
                                            $scope.loadingStart = false;
                                            var data = response.data;
                                            if (typeof (data.code) != 'undefined' && data.code != null) {
                                                $("#note").html(data.message);
                                                $("#note").css("display", "block");
                                            } else {
                                                $window.location.href = "/message_activate_password.html";
                                            }
                                        });
                                    } else {
                                        $scope.loadingStart = false;
                                        $("#note").html("L’email renseigné ne correspond pas à celui de votre compte.");
                                        $("#note").css("display", "block");
                                    }
                                }
                            });
                        };
                    }]);
        </script>
	
    </body>
</html>
